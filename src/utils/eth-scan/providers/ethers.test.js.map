{"version":3,"sources":["../../../src/providers/ethers.test.ts"],"names":["decode","encode","fromHex","toHex","ethers","waffle","ETHER_BALANCES_ID","ETHER_BALANCES_TYPE","TOKEN_BALANCES_ID","TOKEN_BALANCES_TYPE","fixture","withId","EthersProvider","createFixtureLoader","provider","isProvider","send","loadFixture","getWallets","describe","it","expect","toBe","contract","addresses","data","response","to","address","results","i","length","balance","getBalance","success","value","toHexString","slice","padStart","token","mock","balanceOf","returns"],"mappings":"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","sourcesContent":["import { decode, encode, fromHex, toHex } from '@findeth/abi';\nimport { ethers, waffle } from 'hardhat';\nimport { ETHER_BALANCES_ID, ETHER_BALANCES_TYPE, TOKEN_BALANCES_ID, TOKEN_BALANCES_TYPE } from '../constants';\nimport { fixture } from '../eth-scan.test';\nimport { Result } from '../types';\nimport { withId } from '../utils';\nimport EthersProvider from './ethers';\n\nconst { createFixtureLoader, provider } = waffle;\nconst { isProvider, send } = EthersProvider;\n\nconst loadFixture = createFixtureLoader(provider.getWallets(), provider);\n\ndescribe('isProvider', () => {\n  it('checks if a provider is an Ethers.js provider', () => {\n    expect(isProvider(ethers.provider)).toBe(true);\n    expect(isProvider({})).toBe(false);\n  });\n});\n\ndescribe('send', () => {\n  it('gets the Ether balances from the contract', async () => {\n    const { contract, addresses } = await loadFixture(fixture);\n\n    const data = withId(ETHER_BALANCES_ID, encode(ETHER_BALANCES_TYPE, [addresses]));\n    const response = await send<string>(ethers.provider, 'eth_call', [{ to: contract.address, data }]);\n\n    const results = decode(['(bool,bytes)[]'], fromHex(response))[0] as Result[];\n\n    for (let i = 0; i < addresses.length; i++) {\n      const balance = await ethers.provider.getBalance(addresses[i]);\n      const [success, value] = results[i];\n\n      expect(success).toBe(true);\n      expect(toHex(value)).toBe(balance.toHexString().slice(2).padStart(64, '0'));\n    }\n  });\n\n  it('gets the token balances from the contract', async () => {\n    const { contract, addresses, token } = await loadFixture(fixture);\n    await token.mock.balanceOf.returns('1000');\n\n    const data = withId(TOKEN_BALANCES_ID, encode(TOKEN_BALANCES_TYPE, [addresses, token.address]));\n    const response = await send<string>(ethers.provider, 'eth_call', [{ to: contract.address, data }]);\n\n    const results = decode(['(bool,bytes)[]'], fromHex(response))[0] as Result[];\n\n    for (let i = 0; i < addresses.length; i++) {\n      const [success, value] = results[i];\n\n      expect(success).toBe(true);\n      expect(toHex(value)).toBe('00000000000000000000000000000000000000000000000000000000000003e8');\n    }\n  });\n});\n"],"file":"ethers.test.js"}