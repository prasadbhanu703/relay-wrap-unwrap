{"version":3,"sources":["../../../src/providers/eip-1193.test.ts"],"names":["decode","encode","fromHex","toHex","EthereumProvider","network","ethers","waffle","JsonRpcServer","ETHER_BALANCES_ID","ETHER_BALANCES_TYPE","TOKEN_BALANCES_ID","TOKEN_BALANCES_TYPE","fixture","withId","EIP1193Provider","createFixtureLoader","provider","isProvider","send","loadFixture","getWallets","server","hostname","port","ethereumProvider","beforeAll","listen","afterAll","close","describe","it","expect","toBe","contract","addresses","data","response","to","address","results","i","length","balance","getBalance","success","value","toHexString","slice","padStart","token","mock","balanceOf","returns"],"mappings":"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","sourcesContent":["import { decode, encode, fromHex, toHex } from '@findeth/abi';\nimport { EthereumProvider } from 'eip1193-provider';\nimport { network, ethers, waffle } from 'hardhat';\nimport { JsonRpcServer } from 'hardhat/internal/hardhat-network/jsonrpc/server';\nimport { ETHER_BALANCES_ID, ETHER_BALANCES_TYPE, TOKEN_BALANCES_ID, TOKEN_BALANCES_TYPE } from '../constants';\nimport { fixture } from '../eth-scan.test';\nimport { Result } from '../types';\nimport { withId } from '../utils';\nimport EIP1193Provider from './eip-1193';\n\nconst { createFixtureLoader, provider } = waffle;\nconst { isProvider, send } = EIP1193Provider;\n\nconst loadFixture = createFixtureLoader(provider.getWallets(), provider);\n\nconst server = new JsonRpcServer({\n  hostname: '127.0.0.1',\n  port: 8546,\n  provider: network.provider\n});\n\nconst ethereumProvider = new EthereumProvider('http://127.0.0.1:8546');\n\nbeforeAll(async () => {\n  await server.listen();\n}, 100000);\n\nafterAll(async () => {\n  await server.close();\n});\n\ndescribe('isProvider', () => {\n  it('checks if a provider is an EIP-1193 provider', () => {\n    expect(isProvider(ethereumProvider)).toBe(true);\n    expect(isProvider({})).toBe(false);\n  });\n});\n\ndescribe('send', () => {\n  it('gets the Ether balances from the contract', async () => {\n    const { contract, addresses } = await loadFixture(fixture);\n\n    const data = withId(ETHER_BALANCES_ID, encode(ETHER_BALANCES_TYPE, [addresses]));\n    const response = await send<string>(ethereumProvider, 'eth_call', [{ to: contract.address, data }]);\n\n    const results = decode(['(bool,bytes)[]'], fromHex(response))[0] as Result[];\n\n    for (let i = 0; i < addresses.length; i++) {\n      const balance = await ethers.provider.getBalance(addresses[i]);\n      const [success, value] = results[i];\n\n      expect(success).toBe(true);\n      expect(toHex(value)).toBe(balance.toHexString().slice(2).padStart(64, '0'));\n    }\n  });\n\n  it('gets the token balances from the contract', async () => {\n    const { contract, addresses, token } = await loadFixture(fixture);\n    await token.mock.balanceOf.returns('1000');\n\n    const data = withId(TOKEN_BALANCES_ID, encode(TOKEN_BALANCES_TYPE, [addresses, token.address]));\n    const response = await send<string>(ethereumProvider, 'eth_call', [{ to: contract.address, data }]);\n\n    const results = decode(['(bool,bytes)[]'], fromHex(response))[0] as Result[];\n\n    for (let i = 0; i < addresses.length; i++) {\n      const [success, value] = results[i];\n\n      expect(success).toBe(true);\n      expect(toHex(value)).toBe('00000000000000000000000000000000000000000000000000000000000003e8');\n    }\n  });\n});\n"],"file":"eip-1193.test.js"}